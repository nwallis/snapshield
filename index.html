<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
    <script src="./js/classes/Product.js"></script>
    <script src="./js/classes/Hotspot.js"></script>
    <script src="./js/jquery.min.js"></script>
    <link rel="stylesheet" href="./css/snapshield.css">
</head>
<body>
    <script>

var validSequenceJSON = {
    "startingLevel": 1,
    "startingImage": 5,
    "prefix": "cube",
    "levels": 3,
    "images": 10,
    "verticalLoop":false,
    "horizontalLoop":true,
    "hotspotDictionary": {
        "cube-info-1": {
            "type": "bubble",
        },
        "cube-info-2": {
            "type": "sound",
            "url": "http://localhost.snapshield/audio/cube-info-2"
        }
    },
    "hotspotLocations": {
        "cube-1-8": [{
            "x": .2,
            "y": .2,
            "hotspotName": "cube-info-1"
        }, {
            "x": .8,
            "y": .8,
            "hotspotName": "cube-info-2"
        }],
        "cube-1-9": [{
            "x": .3,
            "y": .3,
            "hotspotName": "cube-info-1"
        }, {
            "x": .9,
            "y": .9,
            "hotspotName": "cube-info-2"
        }]
    }
    };

    var productSequence, currentImage, trackingMovement = false, trackStart;
    var trackRatio = { x:30,y:30 };

    $(function(){

        productSequence = new Product(validSequenceJSON);
        currentImage = productSequence.getCurrentImage();

        //Show the starting image
        $("#" + currentImage).show();

        //Stop images being dragged
        $('#client-container img').on('dragstart', function(event) { event.preventDefault(); });

        $(window).mouseup(function(){
            trackingMovement = false;
            trackStart = undefined;
        });

        $(window).resize(function(){
            resizeImages();
            update();
        });

        $(window).mousemove(function(e){
            if (trackingMovement){

                if (trackStart == undefined) trackStart = recordMousePosition(e);
                var currentPosition = recordMousePosition(e);
                var xDiff = currentPosition.xPos - trackStart.xPos;   
                var yDiff = currentPosition.yPos - trackStart.yPos;   

                $("#" + currentImage).hide();
                productSequence.move(yDiff, xDiff);
                currentImage = productSequence.getCurrentImage();
                $("#" + currentImage).show();
                trackStart = recordMousePosition(e);

                //Display the hotspots 
                productSequence.displayCurrentHotspots();
            }
        });

        $("#client-container").mousedown(function(){
            trackingMovement = true; 
        });

        function update(){
            productSequence.displayCurrentHotspots();
        }

        function recordMousePosition(e){
            return {
                xPos:e.clientX,
                yPos:e.clientY
            };
        }

        function resizeImages(){
            //Determine the correct CSS attribute to maintain aspect ratio
            var sequenceContainerWidth = $("#sequence-container").width();
            var sequenceContainerHeight = $("#sequence-container").height();
            if (sequenceContainerWidth > sequenceContainerHeight){
                $(".sequence-image").css("width", "auto");
                $(".sequence-image").css("height", "100%");
            }else{
                $(".sequence-image").css("width", "100%");
                $(".sequence-image").css("height", "auto");
            }

            //Resize hotspot container
            var visibleImageOffset = $(".sequence-image:visible").offset();
            $("#hotspot-container").width($(".sequence-image:visible").width());
            $("#hotspot-container").height($(".sequence-image:visible").height());
            $("#hotspot-container").css("top", visibleImageOffset.top);
            $("#hotspot-container").css("left", visibleImageOffset.left);

        }
        
        resizeImages();
        update();

    });

</script>

<!-- this is the container on the clients HTMl -->
<div id="client-container"> 

    <!-- container created by javascript -->
    <div id="sequence-container">
        <img id="cube-1-1" class="sequence-image" src="./images/cube-1-1.jpg">
        <img id="cube-1-2" class="sequence-image" src="./images/cube-1-2.jpg">
        <img id="cube-1-3" class="sequence-image" src="./images/cube-1-3.jpg">
        <img id="cube-1-4" class="sequence-image" src="./images/cube-1-4.jpg">
        <img id="cube-1-5" class="sequence-image" src="./images/cube-1-5.jpg">
        <img id="cube-1-6" class="sequence-image" src="./images/cube-1-6.jpg">
        <img id="cube-1-7" class="sequence-image" src="./images/cube-1-7.jpg">
        <img id="cube-1-8" class="sequence-image" src="./images/cube-1-8.jpg">
        <img id="cube-1-9" class="sequence-image" src="./images/cube-1-9.jpg">
        <img id="cube-1-10" class="sequence-image" src="./images/cube-1-10.jpg">
        <img id="cube-2-1" class="sequence-image" src="./images/cube-2-1.jpg">
        <img id="cube-2-2" class="sequence-image" src="./images/cube-2-2.jpg">
        <img id="cube-2-3" class="sequence-image" src="./images/cube-2-3.jpg">
        <img id="cube-2-4" class="sequence-image" src="./images/cube-2-4.jpg">
        <img id="cube-2-5" class="sequence-image" src="./images/cube-2-5.jpg">
        <img id="cube-2-6" class="sequence-image" src="./images/cube-2-6.jpg">
        <img id="cube-2-7" class="sequence-image" src="./images/cube-2-7.jpg">
        <img id="cube-2-8" class="sequence-image" src="./images/cube-2-8.jpg">
        <img id="cube-2-9" class="sequence-image" src="./images/cube-2-9.jpg">
        <img id="cube-2-10" class="sequence-image" src="./images/cube-2-10.jpg">
        <img id="cube-3-1" class="sequence-image" src="./images/cube-3-1.jpg">
        <img id="cube-3-2" class="sequence-image" src="./images/cube-3-2.jpg">
        <img id="cube-3-3" class="sequence-image" src="./images/cube-3-3.jpg">
        <img id="cube-3-4" class="sequence-image" src="./images/cube-3-4.jpg">
        <img id="cube-3-5" class="sequence-image" src="./images/cube-3-5.jpg">
        <img id="cube-3-6" class="sequence-image" src="./images/cube-3-6.jpg">
        <img id="cube-3-7" class="sequence-image" src="./images/cube-3-7.jpg">
        <img id="cube-3-8" class="sequence-image" src="./images/cube-3-8.jpg">
        <img id="cube-3-9" class="sequence-image" src="./images/cube-3-9.jpg">
        <img id="cube-3-10" class="sequence-image" src="./images/cube-3-10.jpg">

        <!-- Container created by javascript -->
        <div id="hotspot-container"></div>

    </div>
</div>
</body>
</html>
